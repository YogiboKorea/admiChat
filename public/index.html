<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dongle&family=Nanum+Gothic&family=Noto+Sans+KR:wght@100..900&family=Yuji+Mai&display=swap" rel="stylesheet">
  <style>
    /* 기본 리셋 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      list-style: none;
      font-size:13px;
      font-family: "Noto Sans KR", sans-serif;
    }
    a{color:#3aa0a9}
    body {
      min-width: 320px;
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
}
    .chat-container {
      background: #fff;
      width: 420px;
      max-width: 100%;
      border: 1px solid #ddd;
      border-radius: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      margin-top:20px;
    }
    .chat-header {
      background: #fff;
      color: #111;
      padding: 15px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
    }
    .chat-messages {
      padding: 15px;
      height: auto;
      overflow-y: auto;
      background: #fff;
    }
    .message {
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }
    .message.user {
      align-items: flex-end;
    }
    .message.bot {
      align-items: flex-start;
    }
    .message.bot .bot-container {
      display: flex;
      align-items: flex-start;
    }
    .bot-profile {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .bot-message {
      max-width: 100%;
      background: #f9f9f9;
      color: #333;
      padding: 10px;
      border-radius: 5px;
      word-wrap: break-word;
    }
    .message.user div {
      max-width: 70%;
      background: #58b5ca;
      color: #fff;
      padding: 10px;
      border-radius: 5px;
      margin: 0;
      word-wrap: break-word;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #ddd;
      padding: 5px;
      flex-direction: column;
    }
    .chat-input input,
    .chat-input button {
      font-size: 1em;
    }
    .date-inputs {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    .date-inputs input {
      width: 48%;
      padding: 5px;
    }
    .chat-input textarea {
      width: 100%;
      resize: none;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    .chat-input button {
      padding: 10px;
      border: none;
      background: #58b5ca;
      color: #fff;
      cursor: pointer;
    }
    .first_chat_img {
      text-align: center;
      margin-bottom: 15px;
    }
    .init-message {
      font-size: 12px;
      margin-top: 10px;
      text-align: center;
    }
    /* 키워드 영역 스타일: 4칸 그리드 (2줄) */
    .key_word {
      background: #e9e9e9;
      padding: 10px;
      max-width:400px;
    }
    .key_word ul {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 5px;
    padding: 0;
    margin: 0;
    width: 100%;
    max-width:400px;
  }
    .key_word ul li {
      background: #58b5ca;
      color: #fff;
      padding: 5px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 12px;
      text-align: center;
    }
    .key_word ul li:hover {
      background: #3aa0a9;
    }

    /*안쪽 채팅 부분 css*/
    .product-ranking{
      display: flex;
      align-items: center; 
      gap: 10px; padding:5px; 
      border: 1px solid #ddd; 
      border-radius: 5px;
      background:#fff
    }
    .product-ranking .rank{
      font-weight: bold; color:#333;
    }
    .product-ranking .image{
      flex-shrink: 0;
    }
    .product-ranking .image img
    {
    max-width:60px; width:60px; height:auto; border-radius: 5px;
    }
    .product-ranking .details {
      display: flex; flex-direction: column;
    }
    .product-ranking .product-name{
      font-weight:600; color: #333;
    }
    .product-ranking .product-count
    {
      font-size: 11px; color: #555;
    }

    @media (max-width: 420px) {
      .chat-container {
        margin: 10px;
      }
      .chat-header, .chat-messages, .chat-input {
        padding: 10px;
      }
      body {
        font-size: 12px;
      }
    }

  </style>
</head>
<body>
  <div style="width:95%;margin:0 auto;max-width:420px">
    <!-- 키워드 영역 -->
    <div class="key_word">
      <ul>
        <li>기간별 장바구니 순위</li>
        <li>기간별 페이지뷰 순위</li>
        <li>시간대별 결제 금액 추이</li>
        <li>검색 키워드별 구매 순위</li>
        <li>광고별 판매 순위</li>
        <li>광고별 자사몰 유입수</li>
        <li>일별 방문자 확인</li>
        <li>상세페이지 접속 순위</li>
        <!--
        <li>기간별 판매순위</li>
        <li>이전 페이지 접속 URL</li>
        -->
      </ul>
    </div>
    <div class="chat-container">
      <div class="chat-header" onclick="location.href='https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app'">Yogibo Chat</div>
      <div id="chat-messages" class="chat-messages">
        <div class="first_chat_img">
          <img src="http://yogibo.kr/web/test/tmp-3922227795.webp" style="width:80px;" alt=""/>
          <div class="init-message">마케팅 판매데이터 조회</div>
        </div>
      </div>
      <div class="chat-input">
        <div class="date-inputs">
          <input id="start-date" type="date" placeholder="시작일">
          <input id="end-date" type="date" placeholder="종료일">
        </div>
        <textarea id="message-input" placeholder="기간 미 설정시 한달기준 데이터가 노출됩니다"></textarea>
        <button id="send-btn">입력</button>
      </div>
    </div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const chatMessages = document.getElementById("chat-messages");
    const messageInput = document.getElementById("message-input");
    const sendBtn = document.getElementById("send-btn");
    const startDateInput = document.getElementById("start-date");
    const endDateInput = document.getElementById("end-date");
  
    // 로컬 날짜 포맷 변환 (YYYY-MM-DD)
    function getLocalDateString(date) {
      const year = date.getFullYear();
      const month = ("0" + (date.getMonth() + 1)).slice(-2);
      const day = ("0" + date.getDate()).slice(-2);
      return `${year}-${month}-${day}`;
    }
  
    // 최근 30일 기간 기본 설정
    function getLastTwoWeeksDates(providedDates) {
      if (providedDates && providedDates.start_date && providedDates.end_date) {
        return { start_date: providedDates.start_date, end_date: providedDates.end_date };
      }
      const now = new Date();
      const end_date = getLocalDateString(now);
      const pastDate = new Date(now);
      pastDate.setDate(now.getDate() - 30);
      const start_date = getLocalDateString(pastDate);
      return { start_date, end_date };
    }
  
    // 키워드 버튼 클릭 시 메시지 자동 입력 및 전송
    document.querySelectorAll('.key_word ul li').forEach(item => {
      item.addEventListener("click", () => {
        messageInput.value = item.innerText;
        sendMessage(); // 클릭하면 자동 전송
      });
    });
  
    // 숫자로 시작하는 목록을 감지하여 <ol> 변환
    function formatNumberedList(text) {
      const pattern = /\d+\.\s+/g;
      const matches = text.match(pattern);
      if (matches && matches.length >= 2) {
        const listRegex = /(\d+\.\s*[^0-9]+)/g;
        const items = text.match(listRegex);
        if (items) {
          return '<ol style="padding-left: 20px; margin: 0;">' +
            items.map(item => `<li>${item.trim()}</li>`).join('') +
            '</ol>';
        }
      }
      return text;
    }
  
    // 봇 메시지 추가 (일반 텍스트)
    function appendBotMessage(fullText) {
      const messageElem = document.createElement("div");
      messageElem.classList.add("message", "bot");
      const botContainer = document.createElement("div");
      botContainer.classList.add("bot-container");
      const botImg = document.createElement("img");
      // HTTPS로 변경하여 Mixed Content 경고 방지
      botImg.src = "https://yogibo.kr/web/test/tmp-3922227795.webp";
      botImg.alt = "Bot Profile";
      botImg.classList.add("bot-profile");
      const botMessageDiv = document.createElement("div");
      botMessageDiv.classList.add("bot-message");
      botMessageDiv.innerHTML = formatNumberedList(fullText);
      botContainer.appendChild(botImg);
      botContainer.appendChild(botMessageDiv);
      messageElem.appendChild(botContainer);
      chatMessages.appendChild(messageElem);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  
    // 사용자 메시지 추가
    function appendUserMessage(text) {
      const messageElem = document.createElement("div");
      messageElem.classList.add("message", "user");
      const messageText = document.createElement("div");
      messageText.innerHTML = text;
      messageElem.appendChild(messageText);
      chatMessages.appendChild(messageElem);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  
    // 고유 캔버스 ID 생성 (중복 방지)
    function generateUniqueId(prefix = "chart") {
      return prefix + "_" + Math.random().toString(36).substr(2, 9);
    }
  
    // 캔버스 요소 생성 함수
    function createCanvasElement() {
      const canvasId = generateUniqueId();
      const messageElem = document.createElement("div");
      messageElem.classList.add("message", "bot");
      const canvas = document.createElement("canvas");
      canvas.id = canvasId;
      canvas.width = 400;
      canvas.height = 200;
      messageElem.appendChild(canvas);
      chatMessages.appendChild(messageElem);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      return canvasId;
    }
  
    // 시간대별 매출액 차트 생성 함수 (바 차트)
    async function createSalesChart(canvasId) {
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
      try {
        const response = await axios.get("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/salesHourly", {
          params: { start_date, end_date }
        });
        const data = response.data;
        const labels = data.map(item => `${item.hour}시`);
        const salesData = data.map(item => item.order_amount);
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: '매출액',
              data: salesData,
              backgroundColor: 'rgba(88,181,202,0.5)',
              borderColor: 'rgba(88,181,202,1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value.toLocaleString();
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error fetching salesHourly data:", error);
        appendBotMessage("시간대별 매출 그래프를 불러오는 중 오류가 발생했습니다.");
      }
    }
  
    // 광고 매체별 판매 매출액 차트 생성 함수 (바 차트)
    async function createAdSalesChart(canvasId) {
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
      try {
        const response = await axios.get("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/adSalesGraph", {
          params: { start_date, end_date }
        });
        const { labels, orderAmounts } = response.data;
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: '광고 매체별 판매 매출액',
              data: orderAmounts,
              backgroundColor: 'rgba(75,192,192,0.5)',
              borderColor: 'rgba(75,192,192,1)',
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y',
            scales: {
              x: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value.toLocaleString();
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error fetching adSalesGraph data:", error);
        appendBotMessage("광고 매체별 판매 그래프를 불러오는 중 오류가 발생했습니다.");
      }
    }
  
    // Doughnut 차트 버전: 키워드별 구매 순위 차트 생성 함수
    async function createKeywordSalesChart(canvasId) {
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
      try {
        const response = await axios.get("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/keywordSalesGraph", {
          params: { start_date, end_date }
        });
        const { labels, orderAmounts } = response.data;
        
        // orderAmounts에 포함된 천단위 구분 기호(콤마)를 제거하고 숫자로 변환
        const numericOrderAmounts = orderAmounts.map(val => {
          const raw = val.toString().replace(/,/g, '');
          return parseFloat(raw);
        });
        
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              label: '키워드별 구매 순위 (매출액)',
              data: numericOrderAmounts,
              backgroundColor: [
                'rgba(75,192,192,0.5)',
                'rgba(255,99,132,0.5)',
                'rgba(54,162,235,0.5)',
                'rgba(255,206,86,0.5)',
                'rgba(153,102,255,0.5)',
                'rgba(255,159,64,0.5)',
                'rgba(199,199,199,0.5)',
                'rgba(83,102,255,0.5)',
                'rgba(255,153,102,0.5)',
                'rgba(102,255,102,0.5)',
                'rgba(102,102,255,0.5)',
                'rgba(255,102,255,0.5)',
                'rgba(192,192,192,0.5)',
                'rgba(255,204,153,0.5)',
                'rgba(23,204,153,0.5)',
                'rgba(23,23,153,0.5)',
                'rgba(232,105,153,0.5)'
              ],
              borderColor: [
                'rgba(75,192,192,1)',
                'rgba(255,99,132,1)',
                'rgba(54,162,235,1)',
                'rgba(255,206,86,1)',
                'rgba(153,102,255,1)',
                'rgba(255,159,64,1)',
                'rgba(199,199,199,1)',
                'rgba(83,102,255,1)',
                'rgba(255,153,102,1)',
                'rgba(102,255,102,1)',
                'rgba(102,102,255,1)',
                'rgba(255,102,255,1)',
                'rgba(192,192,192,1)',
                'rgba(255,204,153,1)',
                'rgba(23,204,153,1)',
                'rgba(23,23,153,1)',
                'rgba(232,105,153,1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label || '';
                    if (label) { label += ': '; }
                    if (context.raw !== null) {
                      label += Number(context.raw).toLocaleString('ko-KR') + " 원";
                    }
                    return label;
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error fetching keywordSalesGraph data:", error);
        appendBotMessage("키워드별 구매 순위 그래프를 불러오는 중 오류가 발생했습니다.");
      }
    }

    function parseDailyVisitorStats(statsTextArray) {
      const dates = [];
      const visitCounts = [];
      const firstVisitCounts = [];
      const reVisitCounts = [];
      
      // 날짜: "YYYY-MM-DD" 형식, 수치: "방문자수: 3945, 처음 방문수: 2398, 재방문수: 1552"
      const dateRegex = /(\d{4}-\d{2}-\d{2})/;
      const numbersRegex = /방문자수:\s*(\d+),\s*처음 방문수:\s*(\d+),\s*재방문수:\s*(\d+)/;
      
      statsTextArray.forEach(item => {
        const dateMatch = item.match(dateRegex);
        const numbersMatch = item.match(numbersRegex);
        if (dateMatch && numbersMatch) {
          dates.push(dateMatch[1]);
          visitCounts.push(Number(numbersMatch[1]));
          firstVisitCounts.push(Number(numbersMatch[2]));
          reVisitCounts.push(Number(numbersMatch[3]));
        }
      });
      
      return { dates, visitCounts, firstVisitCounts, reVisitCounts };
    } 
    async function createDailyVisitorChart(canvasId) {
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
      try {
        // 서버의 /dailyVisitorStats 엔드포인트가 HTML 텍스트 배열을 반환한다고 가정합니다.
        const response = await axios.get("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/dailyVisitorStats", {
          params: { start_date, end_date },
          headers: { 'Content-Type': 'application/json' }
        });
        console.log("Daily Visitor Stats API 응답 데이터:", response.data);
        
        // 서버에서 반환한 데이터를 statsTextArray에 저장
        const statsTextArray = response.data;
        
        // 파싱하여 차트에 사용할 구조화된 데이터 추출
        const { dates, visitCounts, firstVisitCounts, reVisitCounts } = parseDailyVisitorStats(statsTextArray);
        
        // 캔버스 요소 얻기
        const ctx = document.getElementById(canvasId).getContext('2d');
        
        // Chart.js 라인 차트 생성
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [
              {
                label: '방문자수',
                data: visitCounts,
                borderColor: 'rgba(75,192,192,1)',
                backgroundColor: 'rgba(75,192,192,0.2)',
                fill: false,
                tension: 0.1
              },
              {
                label: '처음 방문수',
                data: firstVisitCounts,
                borderColor: 'rgba(255,99,132,1)',
                backgroundColor: 'rgba(255,99,132,0.2)',
                fill: false,
                tension: 0.1
              },
              {
                label: '재방문수',
                data: reVisitCounts,
                borderColor: 'rgba(54,162,235,1)',
                backgroundColor: 'rgba(54,162,235,0.2)',
                fill: false,
                tension: 0.1
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) { label += ': '; }
                    if (context.raw !== null) {
                      label += Number(context.raw).toLocaleString('ko-KR') + " 명";
                    }
                    return label;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return value.toLocaleString('ko-KR') + " 명";
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error fetching daily visitor stats for chart from text:", error);
        appendBotMessage("일일 방문자 차트를 불러오는 중 오류가 발생했습니다.");
      }
    }

    async function createAdInflowChart(canvasId) {
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
      try {
        const response = await axios.get("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/adInflowGraph", {
          params: { start_date, end_date },
          headers: { 'Content-Type': 'application/json' }
        });
        const { labels, visitCounts } = response.data;
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              label: '광고별 유입수',
              data: visitCounts,
              backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(153, 102, 255, 0.5)',
                'rgba(255, 159, 64, 0.5)',
                'rgba(199, 199, 199, 0.5)',
                'rgba(83, 102, 255, 0.5)',
                'rgba(102, 255, 102, 0.5)',
                'rgba(102, 102, 255, 0.5)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(199, 199, 199, 1)',
                'rgba(83, 102, 255, 1)',
                'rgba(102, 255, 102, 1)',
                'rgba(102, 102, 255, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    let label = context.label || '';
                    if (label) { label += ': '; }
                    if (context.raw !== null) {
                      label += Number(context.raw).toLocaleString('ko-KR') + " 명";
                    }
                    return label;
                  }
                }
              }
            }
          }
        });
      } catch (error) {
        console.error("Error fetching ad inflow graph data:", error);
        appendBotMessage("광고별 유입수 차트를 불러오는 중 오류가 발생했습니다.");
      }
    }




    // 차트 메시지 추가 함수: 시간대별 매출액 차트 호출
    function appendChartMessage() {
      const canvasId = createCanvasElement();
      createSalesChart(canvasId);
    }
  
    // 차트 메시지 추가 함수: 광고 매체별 판매 차트 호출
    function appendAdChartMessage() {
      const canvasId = createCanvasElement();
      createAdSalesChart(canvasId);
    }
  
    // 차트 메시지 추가 함수: 키워드별 구매 순위 차트 호출
    function appendKeywordSalesChartMessage() {
      const canvasId = createCanvasElement();
      createKeywordSalesChart(canvasId);
    }
    // 차트 메시지 추가 함수: 광고 유입수
    function appendAdInflowChartMessage() {
      const canvasId = createCanvasElement();
      createAdInflowChart(canvasId);
    }


    // 메시지 전송 함수
    async function sendMessage() {
      const userMessage = messageInput.value.trim();
      if (!userMessage) return;
  
      const firstChatImg = document.querySelector('.first_chat_img');
      if (firstChatImg) {
        firstChatImg.style.display = 'none';
      }
  
      appendUserMessage(userMessage);
      messageInput.value = "";
  
      const start_date = startDateInput.value || "";
      const end_date = endDateInput.value || "";
  
      try {
        const response = await axios.post("https://port-0-admichat-lzgmwhc4d9883c97.sel4.cloudtype.app/chat", {
          message: userMessage,
          start_date: start_date,
          end_date: end_date
        }, {
          headers: {
            "Content-Type": "application/json"
          }
        });
  
        const data = response.data;
        // 시간대별 결제 금액 추이 그래프 처리
        if (userMessage.includes("시간대별 결제 금액 추이")) {
          appendBotMessage("아래 그래프에서 시간대별 매출액을 확인하세요.");
          appendChartMessage();
        }
        // 광고 매체별 판매 그래프 처리
        else if (userMessage.includes("광고별 판매 순위")) {
          appendBotMessage("아래 그래프에서 광고 매체별 판매 매출액을 확인하세요.");
          appendAdChartMessage();
        }
        // 키워드별 구매 순위 차트 처리 (검색 키워드별 구매 순위)
        else if (userMessage.includes("검색 키워드별 구매 순위")) {
          appendBotMessage("아래 그래프에서 키워드별 구매 순위를 확인하세요.");
          appendKeywordSalesChartMessage();
        }
        else if (userMessage.includes("일별 방문자 확인")) {
            appendBotMessage("아래 차트에서 일별 방문자 순위를 확인하세요.");
            const canvasId = createCanvasElement();
            createDailyVisitorChart(canvasId);
        } 
        else if (userMessage.includes("광고별 자사몰 유입수")) {
            appendBotMessage("광고별 자사몰 유입수 순위를 확인하세요.");
            const canvasId = createCanvasElement();
            createAdInflowChart(canvasId);
        } 
        else {
          let botResponse = data.text;
          if (data.videoHtml) {
            botResponse += "<br>" + data.videoHtml;
          }
          if (data.imageUrl) {
            if (!botResponse.includes("<img") && !botResponse.includes("<iframe")) {
              botResponse += "<br><img src='" + data.imageUrl + "' alt='image' style='max-width:100%;'/>";
            }
          }
          appendBotMessage(botResponse);
        }
      } catch (error) {
        appendBotMessage("오류가 발생했습니다. 다시 시도해주세요.");
        console.error("Error:", error);
      }
    }
  
    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
  </script>
  